<!DOCTYPE html>
<html lang="en">
<!-- This is boilerplate HTML header stuff -->
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>View Users</title>
</head>

<!-- We will have a very small html body for this page, it's basically empty with a palceholder we will use to 
add our data to. We give the <div> element an id attribute so that we can find the element in the DOM later.
We want to use this element to add new HTML into the document, the content that comes back from our fetch() request-->
<body>
   
    Get user by Id: <input type="number" onkeypress="return event.charCode >= 48 && event.charCode <= 57" id="userId" value="0"><br>
     <!-- onkeypress="return event.charCode >= 48 && event.charCode <= 57" checks the input as the keyboard keys are pressed to prevent the input of anthing other than 0-9 so no decimals or - allowed -->
    <p>(Leave zero if you want to see them all)</p> <br>

    <button type=" button" onclick="getUsers()" >Show Them To Me!</button>
    <div id="UserEdit"></div>
    <div id="userList"></div>
</body>

<!-- And now the script portion where we can write our javascript code -->
<script>
  let htmlElement= document.getElementById("UserEdit")
  /*if(window.sessionStorage.getItem('admin') == "true"){

    htmlElement.innerHTML += "<button type='button' onclick='openUser()'>Change User Permissions</button>"

  }*/

async function changeUser(){


}

    async function getUsers() {
        // url is a server location 
        
        let userIdent = document.getElementById("userId").value
        let url = 'http://localhost:8080/IL-p1/user'
       
       
        if (userIdent >= 1 ) {
            
            url += '?user-id='+ userIdent;
            console.log(url)
            
        } 
        let response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json;charset=utf-8'
            }
        });

        let htmlElement = document.getElementById('userList');
        htmlElement.innerHTML = ' '
        if(userIdent >= 1 ){
            
           let user = await response.json();
            console.log(user.firstName)
        //get the element where we will place our content
       

        //This is just looping through an array, exactly the same as Java
        

            
            

                    //insert into the web page the data
                htmlElement.innerHTML += "<h4>UserID: " + user.userId + "</h4>"
                htmlElement.innerHTML += "<h4>First Name: " + user.firstName + "</h4>"
                htmlElement.innerHTML += "<h4>Last Name: " + user.lastName + "</h4>"
                htmlElement.innerHTML += "<p>Email: " + user.email + "</p>"
                htmlElement.innerHTML += "<p>Admin: " + user.admin + "</p><br><br>"
            if(window.sessionStorage.getItem('admin')== "true" ){
                
                htmlElement.innerHTML+= "<select name='administer' id='administer' required><optgroup label='Shall they join the council?'><option value='false'>They shall not obtain the rank of Admin(No)</option><option value='true'>They have earned the rank of Admin(yes)</option></optgroup></select>"
                htmlElement.innerHTML+="<button type='button' onclick='changeUser()'>Change User Permissions</button>"

            
            }
        }else{
        //parse the JSON in that response
        let array = await response.json();

        //get the element where we will place our content
        

        //This is just looping through an array, exactly the same as Java
        for (let i = 0; i < array.length; i++) {
            let user = array[i];


            //insert into the web page the data
            htmlElement.innerHTML += "<h4>UserID: " + user.userId + "</h4>"
            htmlElement.innerHTML += "<h4>First Name: " + user.firstName + "</h4>"
            htmlElement.innerHTML += "<h4>Last Name: " + user.lastName + "</h4>"
            htmlElement.innerHTML += "<p>Email: " + user.email + "</p>"
            htmlElement.innerHTML += "<p>Admin: " + user.admin + "</p><br><br>"
        }
            /* Our array contains all of the task objects sent back from the API in response to our request. 
            As we loop through it we create and insert content into the body of our HTML document above. When we 
            have finished traversing the array, we should see the info about our tasks on the page.

            innerHTML is literally the text which would be nested inside the element. In this case the element is the 
            <div> above with the id "taskList". We find that element and insert the HTML tags and text to make our task info
            appear on screen.
            */
        }


    };//This is the part of the IIFE expression where we give it the parameter "1" and invoke the function.


</script>

</html>